aBubPubSub=function(a){this.VERSION="0.8.7";this.id="bubPubSub_"+(new Date).getTime();"string"===typeof a&&(this.id=a);this.defaults={bubble:!0,persist:!1,getBubbles:!0,getPersists:!1,chain:!1,scope:this,debugging:0,forceUniqueSubscriber:!0,skipOverFailedSubscribers:!0,chainDelay:0,throwErrors:!1,catchSubscriberErrors:!1};this.errors=[];this.publicationChannels={};this.publicationLog=[];this.publicationAnnouncements=[];return this};
aBubPubSub.prototype.publish=function(a,c,b,d,g){var e={scope:this.defaults.scope,persist:this.defaults.persist,bubble:this.defaults.bubble,chain:this.defaults.chain,chainDelay:this.defaults.chainDelay,silent:!1},j=[];"object"===typeof b&&("object"===typeof b.scope&&(e.scope=b.scope),"boolean"===typeof b.persist&&(e.persist=b.persist),"boolean"===typeof b.bubble&&(e.bubble=b.bubble),"boolean"===typeof b.chain&&(e.chain=b.chain),"number"===typeof b.chainDelay&&(e.chainDelay=b.chainDelay),"boolean"===
typeof b.silent&&(e.silent=b.silent));"function"!==typeof g&&(g=!1);a=this.__stripSlashes(a);c.originalTopic=a;var f=(new Date).getTime();c.uniquePublicationId="pub_"+f+"_"+Math.floor(1E5*Math.random());0<this.defaults.debugging&&!1===e.silent&&console.log("["+this.id+"] publication: #"+c.uniquePublicationId+" ("+a+") | bubbling="+e.bubble+" | persistent="+e.persist+" | publisher="+d);f=[a];if(!0===e.bubble)for(var i=a.lastIndexOf("/");-1<i;)i=a.substr(0,i),""!==i&&f.push(i),i=i.lastIndexOf("/");
f.push("/");for(var i=[],q=f.length,k=0;k<q;k++)for(var m in this.publicationChannels[f[k]]){var h=this.publicationChannels[f[k]][m];if(!(0!==k&&!0!==h.getBubbles)){var n={topic:f[k],id:m};0<this.defaults.debugging&&!1===e.silent&&console.log("["+this.id+"] subscription got #"+c.uniquePublicationId+". ("+f[k]+") from ("+c.originalTopic+") | getBubbles="+h.getBubbles+" | subscriber="+m);var p="object"===typeof h.scope?h.scope:e.scope;if(!0!==e.chain){if(!0===this.defaults.catchSubscriberErrors)try{h.callback.apply(p,
[c,f[k],d,g,n])}catch(l){if(0<this.defaults.debugging&&!1===e.silent&&(console.log("["+this.id+"] ERROR: callback error after subscription got #"+c.uniquePublicationId+" @ ("+f[k]+") from ("+c.originalTopic+") | getBubbles="+h.getBubbles+" | subscriber="+m),console.log(l),"undefined"!==typeof l.stack&&console.log(l.stack),this.errors.push(l),1E4<this.errors.length&&this.errors.pop()),!0===this.defaults.throwErrors)throw l;}else h.callback.apply(p,[c,f[k],d,g,n]);h.fired++;i.push(h.id);"number"===
typeof h.autoUnsubscribe&&h.autoUnsubscribe<=h.fired&&this.unsubscribe({id:h.id,topic:h.topic})}else j.push({subscriber:h.callback,argumentArray:[c,f[k],d,g,n]})}}a={topic:a,data:c,settings:b,timestamp:(new Date).getTime(),publisher:d,subscribersFired:i};!0===e.persist&&(this.publicationLog.push(a),1E4<this.publicationLog.length&&this.publicationLog.pop());!0===e.chain&&this.chainCallSubscribers(a,e,j);return a};
aBubPubSub.prototype.subscribe=function(a,c,b,d){var g=this.defaults.getBubbles,e=this.defaults.getPersists,j=this.defaults.forceUniqueSubscriber,f=!1,i=(new Date).getTime();"function"!==typeof c&&(c=function(){return!0});if("boolean"===typeof b)throw console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! BAD / OLD SUBSCRIPTION PARAMETERS!! UPDATE THE FOLLOWING SUBSCRIPTION:"),console.log("-----  legacy parameter support will be deprecated in 0.9 ---------------"),console.log(arguments),Error("PUBSUB ERROR");
"string"===typeof b&&(console.log("!!!---!!!!!!!---!!!!!!!!---!!!!!!---!!!!!! BAD SUBSCRIPTION PARAMETERS!! UPDATE THE FOLLOWING SUBSCRIPTION:"),console.log("-----  legacy parameter support will be deprecated in 0.9 ---------------"),console.log(arguments),d=b,b={});"undefined"===typeof b&&(b={});"boolean"===typeof b.forceUniqueSubscriber&&(j=b.forceUniqueSubscriber);"boolean"===typeof b.getBubbles&&(g=b.getBubbles);if("boolean"===typeof b.autoUnsubscribe||"number"===typeof b.autoUnsubscribe)f=b.autoUnsubscribe;
"string"!==typeof a&&(a="/");a=this.__stripSlashes(a);""===a&&(a="/");"undefined"===typeof this.publicationChannels[a]&&(this.publicationChannels[a]=[]);"string"!==typeof d&&(d="sub_"+i+"_"+Math.floor(1E5*Math.random()));if(!0===j)for(;"undefined"!==typeof this.publicationChannels[a][d];)d+="_"+Math.floor(1E4*Math.random());this.publicationChannels[a][d]={callback:c,getBubbles:g,getPersists:e,autoUnsubscribe:f,id:d,topic:a,fired:0,scope:"object"===typeof b.scope?b.scope:this.defaults.scope};"object"===
typeof b&&"object"===typeof b.scope&&(this.publicationChannels[a][d].scope=b.scope);return{topic:a,id:d}};
aBubPubSub.prototype.unsubscribe=function(a){if("undefined"===typeof a||"undefined"===typeof a.topic||"undefined"===typeof a.id)return!1;if("undefined"!==typeof this.publicationChannels[a.topic]&&"undefined"!==typeof this.publicationChannels[a.topic][a.id]){delete this.publicationChannels[a.topic][a.id];var c=0,b;for(b in this.publicationChannels[a.topic]){c++;break}0===c&&delete this.publicationChannels[a.topic];return!0}return!1};
aBubPubSub.prototype.announce=function(a,c,b,d){c={topic:a,data:c,settings:b,timestamp:(new Date).getTime(),publisher:d};"undefined"===typeof this.publicationAnnouncements[a]&&(this.publicationAnnouncements[a]=[]);this.publicationAnnouncements[a].push(c);return c};aBubPubSub.prototype.wasPublishedOnTopic=function(a,c){"boolean"!==typeof c&&(c=!1);var b=[],d;for(d in this.publicationLog){var g=!1;(g=c?0===this.publicationLog[d].topic.indexOf(a):this.publicationLog[d].topic.indexOf(a)===a)&&b.push(this.publicationLog[d])}return b};
aBubPubSub.prototype.setDefaults=function(a){"undefined"!==typeof a&&("object"===typeof a.scope&&(this.defaults.scope=a.scope),"boolean"===typeof a.persist&&(this.defaults.persist=a.persist),"boolean"===typeof a.bubble&&(this.defaults.bubble=a.bubble),"boolean"===typeof a.forceUniqueSubscriber&&(this.defaults.forceUniqueSubscriber=a.forceUniqueSubscriber),"number"===typeof a.debugging&&(this.defaults.debugging=a.debugging));return this.defaults};
aBubPubSub.prototype.__stripSlashes=function(a){return"string"!==typeof a?"":a.replace(RegExp("^[/]+|[/]+$","g"),"")};
aBubPubSub.prototype.chainCallSubscribers=function(a,c,b){var d=this,g=b.shift(),e=function(){d.chainCallSubscribers(a,c,b)};if("undefined"===typeof g||null===g)return!0;if("function"===typeof g.subscriber.chainedCallback)try{var j=g.argumentArray;j.push(e);0===c.chainDelay?g.subscriber.callback.apply(d.config.scope,j):a.chainTimeout=setTimeout(function(){g.subscriber.callback.apply(d.config.scope,j)},c.chainDelay)}catch(f){0<this.defaults.debugging&&(console.log("[aBubPubSub] ERROR: callback threw an error detailed below while subscription@("+
topicTree[branch]+") | getBubbles="+subscriber.getBubbles+" | subscriber="+subId),console.log(error),"undefined"!==typeof error.stack&&console.log(error.stack),d.errors.push(error),1E4<d.errors.length&&d.errors.pop()),!0===c.skipOverFailedSubscribers&&e()}else e();return!0};
aBubPubSub.prototype.converse=function(a,c){var b={},d=(new Date).getTime();b.id="bpsCon"+d+"_"+Math.round(1E5*Math.random());"boolean"!==typeof c.autoUnsubscribe&&(c.autoUnsubscribe=1);"function"!==typeof c.callback&&(c.autoUnsubscribe=1);"object"!==typeof c.scope&&("undefined"!==typeof arguments.callee&&(c.scope=arguments.callee),c.scope="object"===typeof window?window:"object"===typeof process?process:b);"string"!==typeof a.topic&&(a.topic="/");"object"!==typeof a.data&&(a.data={});"object"!==
typeof a.options&&(a.options={});"undefined"===typeof a.sender&&(a.sender=b.id);b.pubId="pub"+d+"_"+Math.round(1E5*Math.random());"string"!==typeof c.topic&&(c.topic=a.topic+"/done");b.subscription=this.subscribe(c.topic,function(a,d,j,f,i){b.state="received";c.callback.apply(c.scope,[a,d,j,f,i]);b.state="returned"},{scope:c.scope,autoUnsubscribe:c.autoUnsubscribe},b.id);b.state="subscribed";b.publication=this.publish(a.topic,a.data,a.options,a.sender);b.state="published";return b};
function wrapped_bubPubSub(){return new aBubPubSub}(function(){"undefined"!==typeof exports?"undefined"!==typeof module&&module.exports&&(module.exports=aBubPubSub):this.bubPubSub=new aBubPubSub})();
