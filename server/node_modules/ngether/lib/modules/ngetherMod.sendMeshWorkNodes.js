var sendMeshWorkNodes = {
	id: 'sendMeshWorkNodes',
	executor: function(next, thisEscalator) {
		thisEscalator.thisNgether.listenTo(
			[ 'ngether/introduceMe' ],
			[thisEscalator.thisNgether.config.id],
			function(socketMessage, receivedTopic, connection) {
				if (typeof connection.ngether !== 'object') return false;
				if (thisEscalator.thisNgether.config.type === 'hub') {
					var allMyClients = thisEscalator.thisNgether.getClientList();
					delete allMyClients[connection.ngether.partnerConfig.id];
					thisEscalator.thisNgether.tell(
						'ngether/meshWorkNodes',
						{
							knownClients: allMyClients
						},
						[ socketMessage.id ]
					);
					thisEscalator.thisNgether.log.add('sent meshWorkNodes ' + socketMessage.id, 'plain', 'sendMeshWorkNodes');
				}
				return true;
			}
		);
		thisEscalator.thisNgether.log.add('sendMeshWorkNodes plugged in !', 'job', 'init');
		next();
	}
};

module.exports = sendMeshWorkNodes;