ngether
=======

ngether is a nodeJS project based on websocket ( https://github.com/Worlize/WebSocket-Node ) and the bubPubSub data distribution system.
It is primarily meant for allowing dynamically growing/shrinking server-meshworks to communicate and sync events/pubsubs.

# features:

* connect multiple Spots in a n:n fashion (each spot, to each other spot in the meshwork). 

* each SPOT will connect to and receive incoming connections from any other ngether instance. 

* An ngether group will auto-connect each node with each other node, building a meshwork.

* ngether has built-in modules for building a bubPubSub bridge from 'local' pubsubs to the meshwork. 

* ngether allows communication between mesh-nodes by addressing them in the bubpubsub topic: 
	/ngetherId/   : will send via direct connection to the named ngether instance 

* each ngether instance creates a REPL 

* ngether is highly configuarable. the config file is a javascript-file, e.g. https://github.com/Klab-Berlin/ngether/blob/master/demo/config/nspot0.js

* ngether uses a plugin system for easy and fast extendability. 
	
	- a series of useful/example plugins is included here: https://github.com/Klab-Berlin/ngether/tree/master/lib/plugins 
	
	- plugins are encapsulated in escalator steps ( https://github.com/itsatony/escalator ) to allow efficient flow-control during initiation
	
	- plugins can be loaded at runtime using the REPL



# use: 

* a DEMO including extensive config files is given in  /demo  : https://github.com/Klab-Berlin/ngether/tree/master/demo

* to run the demo, edit the config files:
https://github.com/Klab-Berlin/ngether/tree/master/demo/config/nspot0.js   
https://github.com/Klab-Berlin/ngether/tree/master/demo/config/nspot1.js 
https://github.com/Klab-Berlin/ngether/tree/master/demo/config/nspot2.js 
		
to make sense for your network, meaning edit :
````		
// socketServer is the node's OWN server, the address:port it should listen to for incoming ngether connections
socketServer: {
	host: '127.0.0.1',
	port: 9999,
},
// in initiallyConnectTo list the node(s) you want this node to actively try to connect to upon startup
// to start it might make sense to have one node act as 'hub' - not connecting actively, the others connecting to this 'hub'.
initiallyConnectTo: {}
````
		
````
- > cd demo
- > node demo.js ./config/nspot0.js
// in a different screen || on a different machine
- > node demo.js ./config/nspot1.js
````
		
if you set things up correctly in the config the nodes should auto-connect.
	
	
````
// --- TEST telling named meshNodes
ngether.tell('desktops/sync/bla', { a:1, b:2 }, [ 'ngetherSpot02_9992_1222' ]);
ngether.tell('desktops/sync/bla', { a:1, b:2 }, [ 'ngetherSpot02_9992_1222', 'ngetherSpotF01_9993_1223' ] );
````

````
// --- TEST broadcasting
ngether.broadcast('/request/latency/', { a:1, b:2 } );
````

````
// --- TEST emitting
ngether.emit('desktops/sync/emit', { a:1, b:2 } ); 
````

````
// --- TEST broadcasting filtering by poolIds
ngether.broadcast('desktops/sync/broadcasting', { a:1, b:2 }, [ 'webserver' ] );
ngether.broadcast('desktops/sync/broadcasting', { a:1, b:2 }, [ 'spots' ] );
````

````
// --- TEST emitting filtering by poolIds
ngether.emit('desktops/sync/broadcasting', { a:1, b:2 }, [ 'webserver' ] );
ngether.emit('desktops/sync/broadcasting', { a:1, b:2 }, [ 'bla' ] );
ngether.emit('desktops/sync/broadcasting', { a:1, b:2 }, [ 'spots' ] );
````

````
// --- TEST broadcast filtering by poolIds with a limit
ngether.broadcast('desktops/sync/broadcasting', { a:1, b:2 }, [ 'webserver' ], 1 );
ngether.broadcast('desktops/sync/broadcasting', { a:1, b:2 }, [ 'bla' ], 2 );
````

````
// --- TEST emitting filtering by poolIds with a limit
ngether.emit('desktops/sync/broadcasting', { a:1, b:2 }, [ 'webserver' ], 1 );
ngether.emit('desktops/sync/broadcasting', { a:1, b:2 }, [ 'bla' ], 2 );
````
	
````
// --- TEST eventBridges
ngether.eventBridge(process, 'test', 'broadcast', process, process);
process.on('test', function() { console.log('@@@@@@@@@@@@@@EVENT TEST @@@@@@@@@@@@@@@@@@@@@@'); console.log(arguments); } );
process.emit('test', 1, 'b', 3, { d: 'a' });
````



# supplied plugins:

* checkDBconnection
	- status : incomplete
	
	- url: https://github.com/Klab-Berlin/ngether/blob/master/lib/plugins/ngetherPlugin.checkDBconnection.js

	- config section:
````
checkDBSettings: {
	dbsToCheck: [ 'logger' ]
}
````

	- description: this little plugin uses the mongoDB plugin as basis and will constantly check whether the databases given in its config section are reachable.
if not, it will broadcast a pubsub  'connections/dbs/disconnect'
needs an update to work like the checkHttpResponse plugin !
			
	- trigger:
````
ngether.tell('ngether/checkDBconnection/', { sendAlert: true }, [ 'ngetherSpot01_9991_1221' ]);
````

* checkHttpResponse
	- status : working
	
	- url: https://github.com/Klab-Berlin/ngether/blob/ng_ft_ngfs4vws/lib/plugins/ngetherPlugin.checkHttpResponse.js

	- config section:
````
checkHttpResponse: {
	urlsToCheck: [
		{
			url: 'http://www.meinunterricht.de:80/isApacheUp.html',
			interval: 10000,
			addressesToMail: [ 'christian@meinunterricht.de' ],
			lastStatus: true
		}
	]
}
````

	- description: this little plugin will constantly check whether URLs given in its config section are reachable.
if not, it will use the mail plugin to send a notification to a list of addresses provided in the config section.
			
	- trigger: not needed


* fileTransfer
	- status : working, in active development
	
	- url: https://github.com/Klab-Berlin/ngether/blob/ng_ft_ngfs4vws/lib/plugins/ngetherPlugin.fileTransfer.js

	- config section:

	- description: this plugin allows the transfer of files between nodes. it requires the ngetherFS module !
		// TODO
		it needs its own documentation.
		fileTransfer also offers helper functions for ngetherFS to allow easy storing and requesting files to/from the meshwork
		
	- trigger:
````
// sending a file
ngether.ngetherFS.sendFile({ localPath: '/home/itsatony/code/ngether/demo/ngfs0/ngether_mini_logo.png' }, ngether.getConnection('ngetherSpot01_9991_1221'));
// sending a Buffer
ngether.ngetherFS.sendBuffer(
  { 
    data: someBuffer  // NEEDED
    utid: '12345',  // OPTIONAL. a string, a uniqueTransferId - will be autogenerated from a timestamp and randomString if not passed
    autoWrite: false,  // OPTIONAL.  for sendBuffer this defaults to false, for sendFile to true. if true, the receiving spots will write the file to disk
    autoDB: false,  // OPTIONAL.  for sendBuffer this defaults to false, for sendFile to true. if true, the receiving spots will write the fileobject (w/o the data) to the DB
    whateverYouWant: {} // OPTIONAL.
  }, 
  ngether.getConnection('ngetherSpot01_9991_1221')
);
OR, in short,
ngether.ngetherFS.sendBuffer({ data: new Buffer('JUST A TEST TO SEND BINARY') }, ngether.getConnection('ngetherSpot01_9991_1221'));
````


* latency
	- status : working
<<<<<<< HEAD
	
	- url: https://github.com/Klab-Berlin/ngether/blob/ng_ft_ngfs4vws/lib/plugins/ngetherPlugin.latency.js

	- config section:
````
latency: {
	requestLatencyInterval: 10000
}
````

	- description: check how long a message-roundtrip takes between nodes. the interval for latency checks is in the config-section.
			
	- trigger: optionally one could actively ask a spot (with the plugin active):
````
ngether.tell( [ 'ngether/latency/' ], { timestamp: new Date().getTime() }, [ 'ngetherSpot02_9992_1222' ] );
````


* mail
	- status : working
	
	- url: https://github.com/Klab-Berlin/ngether/blob/ng_ft_ngfs4vws/lib/plugins/ngetherPlugin.mail.js

	- config section:
````
=======
	
	- url: https://github.com/Klab-Berlin/ngether/blob/ng_ft_ngfs4vws/lib/plugins/ngetherPlugin.latency.js

	- config section:
````
latency: {
	requestLatencyInterval: 10000
}
````

	- description: check how long a message-roundtrip takes between nodes. the interval for latency checks is in the config-section.
			
	- trigger: optionally one could actively ask a spot (with the plugin active):
````
ngether.tell( [ 'ngether/latency/' ], { timestamp: new Date().getTime() }, [ 'ngetherSpot02_9992_1222' ] );
````


* mail
	- status : working
	
	- url: https://github.com/Klab-Berlin/ngether/blob/ng_ft_ngfs4vws/lib/plugins/ngetherPlugin.mail.js

	- config section:
````
>>>>>>> c1ba810d76904e4afc3c6a8787c3ef383310e183
mailSettings: {
	mode: 'SMTP',
	auth: {
		service: 'Gmail',
		auth: {
			user: '....',
			pass: '....'
		}
	}
},
````

	- description: basic mail-sending plugin
			
	- example: 
````
var from = 'me@ngether.com';
var to = 'you@ngether.com';
var subject = 'a ngether mail demo';
var body = 'any<b>thing</b>';
ngether.sendMail(from, to, subject, body);
````


* mongodb
	- status : working
	
	- url: https://github.com/Klab-Berlin/ngether/blob/ng_ft_ngfs4vws/lib/plugins/ngetherPlugin.mongodb.js

	- config section:
````
mongoDBs: {
	ngfsFiles: {
		id: 'ngfsFiles',
		ip:         '127.0.0.1',
		port:       27017,
		db:         'ngetherFS',
		name:       'ngetherFS',
		collection: 'ngfsFiles'
	}
}
````

	- description: basic mongodb connection provider plugin. all collections given in the config-section will be available to ngether plugins upon initiation completion
			
	- example: 
````
var dbId = 'ngfsFiles';
ngether.mongoClients[dbId].collection.findOne(
	function(err, results) {
		if (err !== null) {
			ngether.log.add('FAILED db connection ' + dbId, 'ERROR', 'checkDBconnection');
			if (socketMessage.sendAlert) {
				ngether.broadcast('connections/dbs/disconnect', { dbId: dbId }, []);
			}
		} else {
			ngether.log.add('PASSED db connection ' + dbId, 'announce', 'checkDBconnection');
		}
	}
);
````


* myprocess
	- status : working
	
	- url: https://github.com/Klab-Berlin/ngether/blob/ng_ft_ngfs4vws/lib/plugins/ngetherPlugin.myprocess.js

	- config section:
````
myProcess: {
	killKey: '123'
}
````

	- description: allows control of the process running ngether . nifty for triggering restarts and the like. includes an example bash script to allow restarting, not only shutdown ( https://github.com/Klab-Berlin/ngether/blob/ng_ft_ngfs4vws/lib/plugins/ngetherPlugin.myprocess.startupScriptDemo.sh )
	currently two main functions are included: killing the own process based on the killKey given in the config-section and requesting/answering process info (memory usage, processor, ...)
			
	- example: 
````
// getting process info from a spot
ngether.tell('process/myProcessInfo/', { processData: {}, id: ng.config.id }, [ 'ngetherSpot01_9991_1221' ]);
// killing a process of a spot
ngether.tell('ngether/killSwitch/', { killKey: '123', restart:1 }, [ 'ngetherSpot01_9991_1221' ]);
````


* panicMail
	- status : working
	
	- url: https://github.com/Klab-Berlin/ngether/blob/ng_ft_ngfs4vws/lib/plugins/ngetherPlugin.panicMail.js

	- config section:
````
panicMailSettings: {
	delayAfterDisconnect: 5000,
	addressesToMail: [ 'toni@viserion.com' ]
}
````

	- description: this plugin listens to certain events (=== bubPubSubs ) and sends out a mail whenever they are triggered . currently supported events are 
		'/connections/disconnect'  <-- published by ngether core
		'connections/dbs/disconnect/'  <-- published by plugin checkDBconnection
			
	- example: 

* receiveMeshWorkNodes
	- status : working
	
	- url: https://github.com/Klab-Berlin/ngether/blob/ng_ft_ngfs4vws/lib/plugins/ngetherPlugin.receiveMeshWorkNodes.js

	- config section:

	- description: this plugin is part of the ngether core system and makes sure that spreading of spots connected to parts of the meshwork is active.
			
	- example: 


* replConvenience
	- status : working
	
	- url: https://github.com/Klab-Berlin/ngether/blob/ng_ft_ngfs4vws/lib/plugins/ngetherPlugin.replConvenience.js

	- config section:

	- description: this plugin just adds shortCut commands for the REPL.
	currently only ngether.showConnectedPartnerInfo();
			
	- example: 
````
ngether.showConnectedPartnerInfo();
````

* sendMeshWorkNodes
	- status : working
	
	- url: https://github.com/Klab-Berlin/ngether/blob/ng_ft_ngfs4vws/lib/plugins/ngetherPlugin.sendMeshWorkNodes.js

	- config section:
````
sendMeshWorkNodes: {
	shoutOutInterval: 600000 // -1 === off
}
````

	- description: this plugin is part of the ngether core system and makes sure that spreading of spots connected to parts of the meshwork is active. 
	it sends info about all connected spots to all other connected spots. this shoutout is sent in an interval determined by the config-section.
			
	- example: 



* simpleAuth
	- status : working
	
	- url: https://github.com/Klab-Berlin/ngether/blob/ng_ft_ngfs4vws/lib/plugins/ngetherPlugin.simpleAuth.js

	- config section:
````
authSettings: {
	useWhiteList: false,
	whiteList: [ 'aSpotId' ],
	usePassword: true,
	password: 'ngether',
	useBlackList: false,
	blackList: [ 'aSpotId' ],
},
````

	- description: this plugin is part of the ngether core system. it enables spot-identification to protext your meshwork. this is VERY WEAK! we strongly suggest to use firewall settings to secure your meshwork!
	use the config-section for whiteListing, blackListing and password setting.
			
	- example: 


* syncClients:

	- status : test-stage
	
	- url: https://github.com/Klab-Berlin/ngether/blob/ng_ft_ngfs4vws/lib/plugins/ngetherPlugin.syncClients.js

	- config section:
````
syncClients: {
	
},
````

	- description: this plugin should sync connected-clients between meshwork spots. development was started for myLinkCloud.com . currently halted
			
	- example: 


* understandEventEmitted
	- status : test-stage
	
	- description: this plugin should sync connected-clients between meshwork spots. development was started for myLinkCloud.com . 
	currently halted.

	- example:


* understandEventEmitted

	- status : test-stage

	- url: https://github.com/Klab-Berlin/ngether/blob/ng_ft_ngfs4vws/lib/plugins/ngetherPlugin.understandEventEmitted.js

	- config section:

	- description: this plugin allows sync/bridging of native nodeJS events between spots
	- example: 
````
ngether.eventBridge( eventName, 'emit||broadcast||tell', targets );
ngether.eventBridge( 'test', 'tell', [ 'ngetherSpot01_9991_1221' ] );
````


# planned features:

